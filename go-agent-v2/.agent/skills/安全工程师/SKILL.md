---
name: å®‰å…¨å·¥ç¨‹å¸ˆè§„èŒƒ
description: å…¨æ ˆå®‰å…¨å·¥ç¨‹æŒ‡å—ï¼Œæ¶µç›–åº”ç”¨å®‰å…¨(AppSec)ã€åŸºç¡€è®¾æ–½å®‰å…¨(InfraSec)ã€ä»£ç å®¡è®¡ä¸åˆè§„æ€§æ£€æŸ¥ã€‚
tags: [security, appsec, owasp, audit, encryption, auth, vulnerability, å®‰å…¨, æ¸—é€æµ‹è¯•, ä»£ç å®¡è®¡, åŠ å¯†, è®¤è¯]
---

# å®‰å…¨å·¥ç¨‹å¸ˆè§„èŒƒ (Security Engineer Standards)

æœ¬æŒ‡å—å®šä¹‰äº† wjboot é¡¹ç›®çš„å®‰å…¨å·¥ç¨‹æ ‡å‡†ã€‚å®‰å…¨ä¸æ˜¯é™„åŠ åŠŸèƒ½ï¼Œè€Œæ˜¯ç³»ç»Ÿçš„å…ç–«ç³»ç»Ÿã€‚

## ä½•æ—¶ä½¿ç”¨

åœ¨ä»¥ä¸‹åœºæ™¯å‚è€ƒæ­¤è§„èŒƒï¼š
*   **æ¶æ„è®¾è®¡**ï¼šè®¾è®¡è®¤è¯(AuthN)ã€æˆæƒ(AuthZ)ã€åŠ å¯†æ–¹æ¡ˆæ—¶ã€‚
*   **ä»£ç å¼€å‘**ï¼šå¤„ç†æ•æ„Ÿæ•°æ®ã€è¾“å…¥éªŒè¯ã€SQL/å‘½ä»¤æ³¨å…¥é˜²æŠ¤æ—¶ã€‚
*   **ä»£ç å®¡è®¡**ï¼šè¿›è¡Œ PR Reviewï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨å®‰å…¨æ¼æ´æ—¶ã€‚
*   **æ¼æ´ä¿®å¤**ï¼šä¿®å¤ç”±æ‰«æå™¨æˆ–ç™½å¸½å­æŠ¥å‘Šçš„æ¼æ´æ—¶ã€‚
*   **éƒ¨ç½²ä¸Šçº¿**ï¼šé…ç½®é˜²ç«å¢™ã€å®¹å™¨éš”ç¦»ã€å¯†é’¥ç®¡ç†æ—¶ã€‚

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒå®‰å…¨åŸåˆ™ (Core Principles)

### 1. é›¶ä¿¡ä»»æ¶æ„ (Zero Trust)
*   **Never Trust, Always Verify**ï¼šä¸ä¿¡ä»»ä»»ä½•å†…ç½‘æµé‡ã€‚æœåŠ¡é—´è°ƒç”¨å¿…é¡»é‰´æƒï¼ˆå¦‚ mTLS æˆ– Tokenï¼‰ã€‚
*   **æœ€å°æƒé™åŸåˆ™ (Least Privilege)**ï¼šåªæˆäºˆåº”ç”¨/ç”¨æˆ·å®Œæˆä»»åŠ¡æ‰€éœ€çš„æœ€å°æƒé™ã€‚DB ç”¨æˆ·ä¸åº”æœ‰ DROP TABLE æƒé™ï¼Œæ™®é€š API Token ä¸åº”æœ‰ Admin æƒé™ã€‚

### 2. çºµæ·±é˜²å¾¡ (Defense in Depth)
*   ä¸è¦ä¾èµ–å•ä¸€é˜²å¾¡å±‚ã€‚ä¾‹å¦‚ï¼šå‰ç«¯æ ¡éªŒ + åç«¯ WAF + API è¾“å…¥æ¸…æ´— + æ•°æ®åº“é¢„ç¼–è¯‘è¯­å¥ + æœ€å°æ•°æ®åº“æƒé™ã€‚

### 3. å®‰å…¨å·¦ç§» (Shift Left)
*   åœ¨ç¼–ç é˜¶æ®µï¼ˆç”šè‡³è®¾è®¡é˜¶æ®µï¼‰å°±å‘ç°å®‰å…¨é—®é¢˜ï¼Œè€Œä¸æ˜¯åœ¨ä¸Šçº¿åçš„æ¸—é€æµ‹è¯•ä¸­ã€‚

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šWeb åº”ç”¨å®‰å…¨ (AppSec)

### 1. OWASP Top 10 é˜²æŠ¤
*   **A01: Broken Access Control (è¶Šæƒ)**
    *   **å¼ºåˆ¶æ£€æŸ¥**ï¼šæ‰€æœ‰ API å¿…é¡»æ£€æŸ¥ `current_user.id == resource.owner_id`ã€‚
    *   **ç¦æ­¢é»˜è®¤å…è®¸**ï¼šä½¿ç”¨ç™½åå•æœºåˆ¶æ§åˆ¶èµ„æºè®¿é—®ã€‚
*   **A02: Cryptographic Failures (åŠ å¯†å¤±è´¥)**
    *   **ä¼ è¾“åŠ å¯†**ï¼šå…¨ç«™å¼ºåˆ¶ HTTPS (TLS 1.2+)ã€‚
    *   **å­˜å‚¨åŠ å¯†**ï¼šå¯†ç å¿…é¡»å“ˆå¸ŒåŠ ç› (Argon2id æˆ– bcrypt)ï¼Œä¸¥ç¦æ˜æ–‡å­˜å‚¨ã€‚æ•æ„Ÿå­—æ®µ (PII, API Key) éœ€åº”ç”¨å±‚åŠ å¯† (AES-GCM)ã€‚
*   **A03: Injection (æ³¨å…¥)**
    *   **SQL æ³¨å…¥**ï¼š100% ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ (Prepared Statements) æˆ– GORM çš„å®‰å…¨æ–¹æ³•ã€‚ä¸¥ç¦å­—ç¬¦ä¸²æ‹¼æ¥ SQLã€‚
    *   **å‘½ä»¤æ³¨å…¥**ï¼šé¿å…ä½¿ç”¨ `exec`, `system` ç­‰æ‰§è¡Œ Shell å‘½ä»¤ã€‚å¦‚å¿…é¡»ï¼Œéœ€ä¸¥æ ¼æ ¡éªŒå‚æ•° whitelistã€‚

### 2. è¾“å…¥ä¸è¾“å‡ºå¤„ç†
*   **Sanitize Input**ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œç±»å‹ã€é•¿åº¦ã€æ ¼å¼æ ¡éªŒã€‚
*   **Escape Output**ï¼šé˜²æ­¢ XSSã€‚åœ¨ HTML ä¸Šä¸‹æ–‡è¾“å‡ºæ—¶è¿›è¡Œ HTML Entity ç¼–ç ï¼›åœ¨ JSON ä¸Šä¸‹æ–‡æ­£ç¡®åºåˆ—åŒ–ã€‚

### 3. è®¤è¯ä¸ä¼šè¯ç®¡ç†
*   **Token å®‰å…¨**ï¼šJWT å¿…é¡»ç­¾å (HS256/RS256)ï¼Œé¿å… `None` ç®—æ³•æ¼æ´ã€‚Set-Cookie å¿…é¡»åŒ…å« `HttpOnly; Secure; SameSite=Strict`ã€‚
*   **é˜²æš´åŠ›ç ´è§£**ï¼šç™»å½•æ¥å£å¿…é¡»å®æ–½é™æµ (Rate Limiting) å’ŒéªŒè¯ç æœºåˆ¶ã€‚

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šä»£ç å®¡è®¡æ¸…å• (Code Audit Checklist)

åœ¨ Review ä»£ç æ—¶ï¼Œå¿…é¡»æ ¸å¯¹ä»¥ä¸‹é¡¹ç›®ï¼š

> **ğŸ›¡ï¸ å®‰å…¨å®¡è®¡ Checkpoints**
>
> **é€»è¾‘æ¼æ´**
> - [ ] ä¿®æ”¹å¯†ç /é‚®ç®±æ˜¯å¦éªŒè¯äº†æ—§å¯†ç ï¼Ÿ
> - [ ] è¿™æ˜¯ä¸€ä¸ªæ”¯ä»˜æ¥å£å—ï¼Ÿé‡‘é¢æ˜¯å¦ä¸ºè´Ÿæ•°ï¼Ÿæ˜¯å¦å¤„ç†äº†å¹¶å‘æ‰£æ¬¾ï¼ˆç«æ€æ¡ä»¶ï¼‰ï¼Ÿ
> - [ ] è®¢å•æŸ¥è¯¢æ˜¯å¦é™åˆ¶äº†åªèƒ½æŸ¥è‡ªå·±çš„ï¼Ÿ(IDOR)
>
> **æ•°æ®æ³„éœ²**
> - [ ] æ—¥å¿—ä¸­æ˜¯å¦æ‰“å°äº†ç”¨æˆ·å¯†ç ã€Token æˆ– PIIï¼Ÿ
> - [ ] é”™è¯¯ä¿¡æ¯æ˜¯å¦æš´éœ²äº†æ•°æ®åº“ç»“æ„æˆ–å †æ ˆä¿¡æ¯ï¼Ÿ
> - [ ] Git æäº¤æ˜¯å¦åŒ…å«äº† `.env` æˆ–å¯†é’¥æ–‡ä»¶ï¼Ÿ
>
> **ä¾èµ–å®‰å…¨**
> - [ ] æ­¤ PR å¼•å…¥çš„æ–°ä¾èµ–æ˜¯å¦æœ‰å·²çŸ¥ CVEï¼Ÿ
> - [ ] `go.sum` / `package-lock.json` æ˜¯å¦è¢«ç¯¡æ”¹ï¼Ÿ

---

## ç¬¬å››éƒ¨åˆ†ï¼šåŸºç¡€è®¾æ–½å®‰å…¨ (InfraSec)

### 1. Secrets Management
*   **ä¸¥ç¦ç¡¬ç¼–ç **ï¼šä»£ç ä¸­ç»å¯¹ä¸èƒ½å‡ºç° AK/SKã€æ•°æ®åº“å¯†ç ã€‚
*   **ä½¿ç”¨ç¯å¢ƒå˜é‡**ï¼šæ‰€æœ‰å¯†é’¥é€šè¿‡ ENV æ³¨å…¥ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ AWS Secrets Manager æˆ– HashiCorp Vaultã€‚

### 2. å®¹å™¨ä¸é•œåƒå®‰å…¨
*   **é Root è¿è¡Œ**ï¼šDockerfile ä¸­å¿…é¡»åˆ›å»ºéç‰¹æƒç”¨æˆ·å¹¶åˆ‡æ¢ (`USER appuser`)ã€‚
*   **æœ€å°åŸºç¡€é•œåƒ**ï¼šä½¿ç”¨ Distroless æˆ– Alpine å‡å°‘æ”»å‡»é¢ã€‚
*   **å®šæœŸæ‰«æ**ï¼šCI æµæ°´çº¿é›†æˆ Trivy æˆ– Snyk æ‰«æé•œåƒæ¼æ´ã€‚

---

## ç¬¬äº”éƒ¨åˆ†ï¼šåº”æ€¥å“åº” (Incident Response)

å½“å‘ç”Ÿå®‰å…¨äº‹ä»¶æ—¶ï¼š
1.  **æ­¢æŸ (Containment)**ï¼šéš”ç¦»å—æ„ŸæŸ“ä¸»æœºï¼Œå°ç¦æ”»å‡»è€… IPï¼Œæš‚åœç›¸å…³æœåŠ¡ã€‚
2.  **æ ¹é™¤ (Eradication)**ï¼šä¿®è¡¥æ¼æ´ï¼Œè½®æ¢æ‰€æœ‰ç›¸å…³å¯†é’¥ (Rotate Secrets)ã€‚
3.  **æ¢å¤ (Recovery)**ï¼šä»å¹²å‡€çš„å¤‡ä»½æ¢å¤æ•°æ®ï¼Œé‡æ–°éƒ¨ç½²æœåŠ¡ã€‚
4.  **å¤ç›˜ (Post-Mortem)**ï¼šåˆ†ææ ¹æœ¬åŸå›  (Root Cause)ï¼Œäº§å‡ºæ”¹è¿›æŠ¥å‘Šã€‚

---

## ç»“è¯­

å®‰å…¨ä¸æ˜¯ä¹°æ¥çš„äº§å“ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ã€‚ä½œä¸ºå®‰å…¨å·¥ç¨‹å¸ˆï¼Œä½ çš„èŒè´£æ˜¯è®©æ”»å‡»è€…çš„æˆæœ¬é«˜äºå…¶æ”¶ç›Šã€‚

---

## ç¬¬å…­éƒ¨åˆ†ï¼šå®‰å…¨ä»£ç ç¤ºä¾‹

### SQL æ³¨å…¥é˜²æŠ¤

```go
// âŒ å±é™©ï¼šç›´æ¥æ‹¼æ¥ SQL
query := fmt.Sprintf("SELECT * FROM users WHERE id = '%s'", userID)

// âœ… å®‰å…¨ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
query := "SELECT * FROM users WHERE id = ?"
db.Query(query, userID)

// âœ… ä½¿ç”¨ ORM
db.Where("id = ?", userID).First(&user)
```

### XSS é˜²æŠ¤

```go
import "html"

// âŒ å±é™©ï¼šç›´æ¥è¾“å‡ºç”¨æˆ·è¾“å…¥
template.HTML(userInput)

// âœ… å®‰å…¨ï¼šè½¬ä¹‰ HTML
html.EscapeString(userInput)

// âœ… ä½¿ç”¨å†…å®¹å®‰å…¨ç­–ç•¥å¤´
w.Header().Set("Content-Security-Policy", 
    "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'")
```

### JWT å®‰å…¨é…ç½®

```go
// âœ… å®‰å…¨çš„ JWT é…ç½®
token := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{
    "sub":  userID,
    "exp":  time.Now().Add(15 * time.Minute).Unix(),  // çŸ­è¿‡æœŸæ—¶é—´
    "iat":  time.Now().Unix(),
    "iss":  "your-app",
    "aud":  "your-app-users",
})

// âœ… éªŒè¯æ—¶æ£€æŸ¥æ‰€æœ‰å£°æ˜
token, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {
    if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {
        return nil, fmt.Errorf("unexpected signing method: %v", token.Header["alg"])
    }
    return []byte(secretKey), nil
})
```

### å¯†ç å®‰å…¨

```go
import "golang.org/x/crypto/bcrypt"

// âœ… å¯†ç å“ˆå¸Œï¼ˆæ³¨å†Œæ—¶ï¼‰
hashedPassword, _ := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)

// âœ… å¯†ç éªŒè¯ï¼ˆç™»å½•æ—¶ï¼‰
err := bcrypt.CompareHashAndPassword(hashedPassword, []byte(inputPassword))
if err != nil {
    // å¯†ç é”™è¯¯ - ä½¿ç”¨ç»Ÿä¸€é”™è¯¯æ¶ˆæ¯é˜²æ­¢æšä¸¾
    return errors.New("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
}
```

### é€Ÿç‡é™åˆ¶

```go
import "golang.org/x/time/rate"

// âœ… åˆ›å»ºé™é€Ÿå™¨ï¼šæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæœ€å¤§çªå‘ 30
limiter := rate.NewLimiter(10, 30)

func rateLimitMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        if !limiter.Allow() {
            http.Error(w, "è¯·æ±‚è¿‡äºé¢‘ç¹", http.StatusTooManyRequests)
            return
        }
        next.ServeHTTP(w, r)
    })
}
```

---

## å®¡æŸ¥æ¸…å•

### è¾“å…¥éªŒè¯
- [ ] æ‰€æœ‰ç”¨æˆ·è¾“å…¥å·²éªŒè¯å’Œæ¸…ç†
- [ ] SQL æŸ¥è¯¢ä½¿ç”¨å‚æ•°åŒ–
- [ ] æ–‡ä»¶ä¸Šä¼ é™åˆ¶ç±»å‹å’Œå¤§å°
- [ ] URL é‡å®šå‘éªŒè¯ç™½åå•

### è®¤è¯æˆæƒ
- [ ] å¯†ç ä½¿ç”¨ bcrypt å“ˆå¸Œ
- [ ] JWT è¿‡æœŸæ—¶é—´åˆç†ï¼ˆ< 15 åˆ†é’Ÿï¼‰
- [ ] æ•æ„Ÿæ“ä½œéœ€è¦é‡æ–°è®¤è¯
- [ ] æƒé™æ£€æŸ¥åœ¨æœåŠ¡ç«¯æ‰§è¡Œ

### æ•°æ®ä¿æŠ¤
- [ ] æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- [ ] æ—¥å¿—ä¸è®°å½•å¯†ç /ä»¤ç‰Œ
- [ ] HTTPS å¼ºåˆ¶å¯ç”¨
- [ ] å“åº”å¤´è®¾ç½®æ­£ç¡®ï¼ˆCSP, X-Frame-Optionsï¼‰

### åŸºç¡€è®¾æ–½
- [ ] å¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥
- [ ] å®¹å™¨ä»¥é root ç”¨æˆ·è¿è¡Œ
- [ ] ä¾èµ–å®šæœŸæ‰«ææ¼æ´
- [ ] æ—¥å¿—è®°å½•å®‰å…¨äº‹ä»¶



---

## âš ï¸ å¼ºåˆ¶è¾“å‡º Token ç©ºé—´

> **é‡è¦è§„åˆ™**ï¼šä½¿ç”¨æ­¤æŠ€èƒ½æ—¶ï¼Œå¿…é¡»åœ¨æ¯æ¬¡é‡è¦è¾“å‡ºå‰æ£€æŸ¥ä¸Šä¸‹æ–‡ç©ºé—´ã€‚

### è¾“å‡ºè§„èŒƒ

æ‰€æœ‰å¯¹è¯å›å¤å†…å®¹éƒ½è¦è¾“å‡º

### è¾“å‡ºæ ¼å¼

```
ğŸ“Š å‰©ä½™ä¸Šä¸‹æ–‡ç©ºé—´: ~{ç™¾åˆ†æ¯”}%
```

### å‘Šè­¦ä¸è‡ªåŠ¨ä¿å­˜

**å½“å‰©ä½™ä¸Šä¸‹æ–‡ç©ºé—´ â‰¤ 30%ï¼ˆå³å·²ä½¿ç”¨ â‰¥ 70%ï¼‰æ—¶ï¼Œå¿…é¡»æ‰§è¡Œï¼š**

1. **ç«‹å³æš‚åœå½“å‰å·¥ä½œ**
2. **ä¿å­˜å·¥ä½œè¿›åº¦**ï¼šåˆ›å»º `.agent/workflows/checkpoint-{timestamp}.md`
3. **é€šçŸ¥ç”¨æˆ·**ï¼š
   ```
   âš ï¸ ä¸Šä¸‹æ–‡ç©ºé—´å³å°†è€—å°½ (å‰©ä½™ ~{ç™¾åˆ†æ¯”}%)
   ğŸ“‹ å·¥ä½œè¿›åº¦å·²ä¿å­˜è‡³: .agent/workflows/checkpoint-{timestamp}.md
   è¯·æ£€æŸ¥åå†³å®šæ˜¯å¦ç»§ç»­æˆ–å¼€å¯æ–°å¯¹è¯
   ```
